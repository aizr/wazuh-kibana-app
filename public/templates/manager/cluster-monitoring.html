<md-content flex layout="column" ng-controller="clusterController" class="manager-groups-main-div overflow-hidden" ng-if="submenuNavItem == 'monitoring'"
    ng-init="lookingNode=false">
    <div flex layout="column" layout-align="start stretch">
        <div flex layout="row" ng-show="!lookingNode">
            <md-card flex ng-class="!lookingNode ? 'mdCardNone' : ''">

                <md-card-content class="groupsFixPadding md-card-content-groups" ng-init="sortNodeTerm=false">
                    <div layout="row" class="topPaddingSearch">
                        <input flex id="query" placeholder="Filter nodes..." type="text" ng-model="searchNodeTerm" class="searchBarCluster input-filter-box agents-preview-search-box"
                        />
                    </div>
                    <md-toolbar layout="row" class="wazuh-toolbar md-toolbar-tools" ng-init="sortNodeTermDir=false">
                        <div flex>
                            <span ng-click="sortNodes('node')">Node
                                <i class="fa" ng-class="sortNodeTerm === 'node' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                        <div flex>
                            <span ng-click="sortNodes('status')">Status
                                <i class="fa" ng-class="sortNodeTerm === 'status' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                        <div flex>
                            <span ng-click="sortNodes('type')">Type
                                <i class="fa" ng-class="sortNodeTerm === 'type' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                        <div flex>
                            <span ng-click="sortNodes('agents')">Agents
                                <i class="fa" ng-class="sortNodeTerm === 'agents' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                        <div flex>
                            <span ng-click="sortNodes('url')">Url
                                <i class="fa" ng-class="sortNodeTerm === 'url' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                        <div flex>
                            <span ng-click="sortNodes('synchFiles')">Synchronized Files
                                <i class="fa" ng-class="sortNodeTerm === 'synchFiles' ? (sortNodeTermDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                    aria-hidden="true"></i>
                            </span>
                        </div>
                    </md-toolbar>
                    <md-divider></md-divider>

                </md-card-content>
                <div flex layout="column" class="md-padding groupsFixPadding" ng-if="!lookingGroup">
                    <div flex class="clusterScrollable">
                        <div layout="row" ng-class-odd="'odd'" ng-class-even="'even'" ng-repeat="item in dataShownHeader.items | filter: searchNodeTerm"
                            ng-click="switchNode(item)" class="ownNavBarGroupsPadding md-subhead agents-groups-preview agents-preview-table groups-table groupsFixPadding"
                            ng-class="item.node==='unknown' ? 'groupsANone' : ''">
                            <div flex>
                                <span class="md-headline" ng-if="item.node !== 'unknown'">{{item.node}}</span>
                                <span class="md-headline" ng-if="item.node === 'unknown'">
                                    <i class="fa fa-warning"></i>
                                </span>
                            </div>
                            <div flex>
                                <span class="md-headline">
                                    <i ng-class="(item.status === 'connected') ? 'fa fa-circle ownGreen' : 'fa fa-circle ownRed'"></i> {{(item.status === 'connected')? ' connected' : ' disconnected'}}</span>
                            </div>
                            <div flex>
                                    <span class="md-headline">{{item.type}}</span>
                                </div>
                            <div flex>
                                <span class="md-headline">{{item.agents}}</span>
                            </div>
                            <div flex>
                                <span class="md-headline">{{item.url}}</span>
                            </div>
                            <div flex>
                                <span class="md-headline">{{item.synchFiles}} / {{item.totalFiles}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <md-progress-linear class="md-accent" md-mode="indeterminate" ng-show="loading"></md-progress-linear>
            </md-card>
        </div>

        <div flex layout="row" layout-align="start stretch" ng-show="lookingNode">
            <md-card flex>
                <div layout="row">
                    <h4 class="own-breadcrumb md-headline">{{ selectedNode.node }} </h4><span flex></span>
                    <span ng-if="status.enabled==='yes'" class="pull-right own-breadcrumb md-headline">
                        <i ng-class="(status.running === 'yes') ? 'fa fa-circle ownGreen' : 'fa fa-circle ownRed'" class="fa fa-circle ownGreen"></i> Running </span>
                    <span ng-if="status.running==='no'" class="pull-right own-breadcrumb md-headline">
                        <i ng-class="(status.enabled === 'yes') ? 'fa fa-circle ownGreen' : 'fa fa-circle ownRed'" class="fa fa-circle ownGreen"></i> Enabled </span>
                </div>
                <md-card-content>
                    <div layout="row">
                        <div flex="15" layout="column">
                            <div flex layout="row">
                                <div flex>
                                    <h4>
                                        <i class="fa fa-reorder"></i> Section
                                    </h4>
                                    <md-divider></md-divider>

                                    <p>
                                        <a ng-click="switchClusterTab('agents')">
                                            <i class="fa fa-tv"></i> Agents
                                        </a>
                                    </p>
                                    <p>
                                        <a ng-click="switchClusterTab('configuration')">
                                            <i class="fa fa-gears"></i> Configuration
                                        </a>
                                    </p>
                                    <p>
                                        <a ng-click="switchClusterTab('files')">
                                            <i class="fa fa-file-o"></i> Files
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div flex="5" layout="column"></div>
                        <div flex layout="column">
                                <div layout="row">
                                    <div flex>
                                        <h4 ng-if="clusterTab==='agents'">
                                                <i class="fa fa-tv"></i> Agents
                                        </h4>
                                        <h4 ng-if="clusterTab==='configuration'">
                                                <i class="fa fa-gears"></i> Configuration
                                            </h4>
                                            <h4 ng-if="clusterTab==='files'">
                                                    <i class="fa fa-file-o"></i> Files
                                                </h4>
                                        <md-divider></md-divider>
                                    </div>
                                </div>
                            <div layout="row" class="ownNavBarCluster topPaddingSearchNoBottom" ng-if="!clusterAgents.busy && clusterTab==='agents' && clusterAgents.items.length === 0">
                                <div flex>

                                    <h4>
                                        <i class="fa fa-warning"></i> No agents connected to this node.</h4>
                                </div>
                            </div>
                            <div layout="row" class="ownNavBarCluster topPaddingSearchNoBottom" ng-if="!clusterAgents.busy && clusterTab==='agents' && clusterAgents.items.length === 0">
                                <div flex>
                                    <p>Use the following link to learn about the agent registration process:
                                    </p>
                                    <ul>
                                        <li>
                                            <a href="https://documentation.wazuh.com/current/user-manual/registering/index.html">https://documentation.wazuh.com/current/user-manual/registering/index.html</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div layout="row" class="topPaddingSearch" ng-if="clusterAgents.items.length > 0 && clusterTab==='agents'">
                                <input flex id="query" placeholder="Filter agents..." type="text" ng-model="searchTerm" ng-change="clusterAgents.addFilter('search', searchTerm)"
                                    class="searchBarCluster input-filter-box agents-preview-search-box" />
                            </div>
                            <div layout="row" class="topPaddingSearch" ng-if="clusterFiles.items.length > 0 && clusterTab==='files'">
                                <input flex id="query" placeholder="Filter files..." type="text" ng-model="searchTerm" ng-change="clusterFiles.addFilter('search', searchTerm)"
                                    class="searchBarCluster input-filter-box agents-preview-search-box" />
                            </div>

                            <md-toolbar layout="row" class="wazuh-toolbar md-toolbar-tools" ng-if="clusterAgents.items.length > 0 && clusterTab==='agents'">
                                <div flex><span ng-click="clusterAgents.sort('id')">Id
                                    <i class="fa" ng-class="clusterAgents.sortValue === 'id' ? (clusterAgents.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>
                                <div flex><span ng-click="clusterAgents.sort('name')">Name
                                    <i class="fa" ng-class="clusterAgents.sortValue === 'name' ? (clusterAgents.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>
                                <div flex><span ng-click="clusterAgents.sort('status')">Status
                                    <i class="fa" ng-class="clusterAgents.sortValue === 'status' ? (clusterAgents.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>
                                <div flex><span ng-click="clusterAgents.sort('ip')">Ip
                                    <i class="fa" ng-class="clusterAgents.sortValue === 'ip' ? (clusterAgents.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>

                            </md-toolbar>
                            <md-divider ng-if="clusterTab==='agents'"></md-divider>
                            <md-toolbar layout="row" class="wazuh-toolbar md-toolbar-tools" ng-if="clusterFiles.items.length > 0 && clusterTab==='files'">
                                <div flex><span ng-click="clusterFiles.sort('filename')">File
                                    <i class="fa" ng-class="clusterFiles.sortValue === 'filename' ? (clusterFiles.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>
                                <div flex><span ng-click="clusterFiles.sort('status')">Status
                                    <i class="fa" ng-class="clusterFiles.sortValue === 'status' ? (clusterFiles.sortDir ? 'fa-sort-asc' : 'fa-sort-desc') : 'fa-sort'"
                                        aria-hidden="true"></i>
                                </span></div>
                            </md-toolbar>
                            <md-divider ng-if="clusterTab==='files'"></md-divider>

                            <div flex layout="row" ng-if="!loading && clusterTab==='agents'">
                                    <div flex ng-if="!loading && clusterAgents.items.length > 0 && clusterTab==='agents'" class="clusterScrollable"
                                        when-scrolled="clusterAgents.nextPage('')">
                                        <div layout="row" ng-class-odd="'odd'" ng-class-even="'even'" ng-repeat="agent in clusterAgents.items | orderBy : clusterAgents.sortValue : clusterAgents.sortDir" ng-click="showAgent(agent)"
                                            class="ownNavBarGroupsPadding md-subhead agents-groups-preview agents-preview-table groups-table">
                
                                            <div flex>
                                                <span class="md-headline">{{agent.id}}</span>
                                            </div>
                                            <div flex>
                                                <span class="md-headline">{{agent.name}}</span>
                                            </div>
                                            <div flex>
                                                <span class="md-headline">
                                                    <i ng-class="(agent.status === 'Active') ? 'fa fa-circle ownGreen' : 'fa fa-circle ownRed'"></i> {{agent.status}}</span>
                                            </div>
                                            <div flex>
                                                <span class="md-headline">{{agent.ip}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <div flex layout="row" ng-if="!loading && clusterTab==='files'">
                                    <div flex ng-if="!loading && clusterFiles.items.length > 0 && clusterTab==='files'" class="clusterScrollable"
                                        when-scrolled="clusterFiles.nextPage('')">
                                        <div layout="row" ng-class-odd="'odd'" ng-class-even="'even'" ng-repeat="file in clusterFiles.items | orderBy : clusterFiles.sortValue : clusterFiles.sortDir" class="ownNavBarGroupsPadding md-subhead agents-groups-preview agents-preview-table groups-table">
                
                                            <div flex>
                                                <span class="md-headline">{{file.filename}}</span>
                                            </div>
                                            <div flex>
                                                <span class="md-headline">
                                                    <i ng-class="(file.status === 'synchronized') ? 'fa fa-circle ownGreen' : 'fa fa-circle ownRed'"></i> {{file.status}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <div flex layout="row" class="md-padding" ng-if="!loading && clusterTab==='configuration'">
                                    <div flex layout="row">
                                        <div flex="30">
                                            <h4>
                                                <i class="fa fa-cubes"></i> Overview</h4>
  
                                            <p>Cluster
                                                <span class="md-secondary pull-right">{{config.name}}</span>
                                            </p>

                                            <p>Node
                                                <span class="md-secondary pull-right">{{config.node_name}}</span>
                                            </p>

                                            <p>Type
                                                <span class="md-secondary pull-right">{{config.node_type}}</span>
                                            </p>
                                        </div>
                                        <div flex></div>
                                        <div flex="30">
                                            <h4>
                                                <i class="fa fa-tasks"></i> Settings</h4>

                                            <p>Disabled
                                                <span class="md-secondary pull-right">{{config.disabled}}</span>
                                            </p>

                                            <p>Hidden
                                                <span class="md-secondary pull-right">{{config.hidden}}</span>
                                            </p>
  
                                            <p>Interval
                                                <span class="md-secondary pull-right">{{config.interval}}</span>
                                            </p>
                                        </div>
                                        <div flex></div>
                                        <div flex="30">
                                            <h4>
                                                <i class="fa fa-feed"></i> Network</h4>
             
                                            <p>Bind address
                                                <span class="md-secondary pull-right">{{config.bind_addr}}</span>
                                            </p>

                                            <p>Port
                                                <span class="md-secondary pull-right">{{config.port}}</span>
                                            </p>
   
                                            <p>Nodes
                                                <span class="md-secondary pull-right">{{config.nodes.length}}</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                </md-card-content>


                <md-progress-linear class="md-accent" md-mode="indeterminate" ng-show="loading || clusterFiles.busy || clusterAgents.busy"></md-progress-linear>
            </md-card>
        </div>
    </div>
</md-content>